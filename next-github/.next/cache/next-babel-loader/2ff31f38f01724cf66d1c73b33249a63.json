{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/pagination/style/css\";\nimport _Pagination from \"antd/lib/pagination\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/list/style/css\";\nimport _List from \"antd/lib/list\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { withRouter } from 'next/router';\nimport { memo, isValidElement } from 'react';\nimport Link from 'next/link';\n\nvar atob = require('atob');\n\nimport Repo from '../components/Repo';\nimport { genCacheKeyByQuery } from '../lib/util';\nimport classNames from 'classnames';\n\nvar api = require('../lib/api');\n\nglobal.atob = atob;\n/**\r\n  * 关心的search条件\r\n  * sort: 排序方式\r\n  * order: 排序升降顺序\r\n  * lang: 仓库开发主语言\r\n  * page: 分页\r\n  */\n\nvar LANGUAGES = ['JavaScript', 'HTML', 'CSS', 'TypeScript', 'Java', 'Vue', 'React'];\nvar SORT_TYPES = [{\n  name: 'Best Match'\n}, {\n  name: 'Most Starts',\n  sort: 'stars',\n  order: 'desc'\n}, {\n  name: 'Fewest Starts',\n  sort: 'stars',\n  order: 'asc'\n}, {\n  name: 'Most Forks',\n  sort: 'forks',\n  order: 'desc'\n}, {\n  name: 'Fewest Forks',\n  sort: 'forks',\n  order: 'asc'\n}];\nvar PER_PAGE = 20;\nvar FilterLink = memo(function (_ref) {\n  var children = _ref.children,\n      query = _ref.query,\n      lang = _ref.lang,\n      sort = _ref.sort,\n      order = _ref.order,\n      page = _ref.page,\n      selected = _ref.selected;\n\n  if (selected) {\n    return __jsx(\"span\", null, children);\n  }\n\n  var queryString = \"?query=\".concat(query);\n\n  if (lang) {\n    queryString += \"&lang=\".concat(lang);\n  }\n\n  if (sort) {\n    queryString += \"&sort=\".concat(sort, \"&order=\").concat(order);\n  }\n\n  if (page) {\n    queryString += \"&page=\".concat(page);\n  }\n\n  queryString += \"&per_page=\".concat(PER_PAGE);\n  return __jsx(Link, {\n    href: \"/search\".concat(queryString)\n  }, isValidElement(children) ? children : __jsx(\"a\", null, children));\n});\n\nfunction Search(_ref2) {\n  var router = _ref2.router,\n      repos = _ref2.repos;\n  var query = router.query;\n  var sort = query.sort,\n      order = query.order,\n      lang = query.lang,\n      _query$page = query.page,\n      page = _query$page === void 0 ? 1 : _query$page;\n  return __jsx(\"div\", {\n    className: \"jsx-91971202\" + \" \" + \"root\"\n  }, __jsx(_Row, {\n    gutter: 20\n  }, __jsx(_Col, {\n    span: 6\n  }, __jsx(_List, {\n    bordered: true,\n    style: {\n      marginBottom: 20\n    },\n    dataSource: LANGUAGES,\n    header: __jsx(\"span\", {\n      className: \"jsx-91971202\" + \" \" + \"list-header\"\n    }, \"\\u8BED\\u8A00\"),\n    renderItem: function renderItem(language) {\n      var selected = lang === language;\n      return __jsx(_List.Item, {\n        className: classNames({\n          selected: selected\n        })\n      }, __jsx(FilterLink, _extends({}, router.query, {\n        selected: selected,\n        lang: language\n      }), language));\n    }\n  }), __jsx(_List, {\n    bordered: true,\n    style: {\n      marginBottom: 20\n    },\n    dataSource: SORT_TYPES,\n    header: __jsx(\"span\", {\n      className: \"jsx-91971202\" + \" \" + \"list-header\"\n    }, \"\\u6392\\u5E8F\"),\n    renderItem: function renderItem(sortItem) {\n      var itemName = sortItem.name,\n          itemSort = sortItem.sort,\n          itemOrder = sortItem.order;\n      var selected = false;\n\n      if (itemName === 'Best Match' && !sort) {\n        selected = true;\n      } else if (itemSort === sort && itemOrder === order) {\n        selected = true;\n      }\n\n      return __jsx(_List.Item, {\n        className: classNames({\n          selected: selected\n        })\n      }, __jsx(FilterLink, _extends({}, router.query, {\n        selected: selected,\n        sort: itemSort,\n        order: itemOrder\n      }), itemName));\n    }\n  })), __jsx(_Col, {\n    span: 18\n  }, __jsx(\"h3\", {\n    className: \"jsx-91971202\" + \" \" + \"repos-title\"\n  }, repos.total_count, \" \\u4E2A\\u4ED3\\u5E93\"), repos.items.map(function (repo) {\n    return __jsx(Repo, {\n      repo: repo,\n      key: repo.id\n    });\n  }), __jsx(\"div\", {\n    className: \"jsx-91971202\" + \" \" + \"pagination\"\n  }, __jsx(_Pagination, {\n    pageSize: PER_PAGE,\n    current: Number(page) // github api限制请求前1000条\n    ,\n    total: Math.min(repos.total_count, 1000),\n    onChange: function onChange() {},\n    itemRender: function itemRender(renderPage, renderType, renderOl) {\n      var targetPage = renderType === 'page' ? renderPage : renderType === 'prev' ? page - 1 : page + 1;\n      var name = renderType === 'page' ? renderPage : renderOl;\n      return __jsx(FilterLink, _extends({}, router.query, {\n        page: targetPage\n      }), name);\n    }\n  })))), __jsx(_JSXStyle, {\n    id: \"91971202\"\n  }, \".ant-list-item.selected{border-left:2px solid #e36209;font-weight:100;}.root.jsx-91971202{padding:20px 0;}.list-header.jsx-91971202{font-weight:800;font-size:16px;}.repos-title.jsx-91971202{border-bottom:1px solid #eee;font-size:24px;line-height:50px;}.pagination.jsx-91971202{margin-top:16px;text-align:right;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFxyZWFjdFN0dWR5XFxOZXh0LUtvYS1HaXRIdWJcXG5leHQtZ2l0aHViXFxwYWdlc1xcc2VhcmNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWdMa0IsQUFHeUMsQUFLZixBQUlDLEFBS2EsQUFNYixlQWRsQixDQUlpQixBQVdFLGFBTkYsQ0FibEIsQ0FTQyxFQVdBLFdBTm1CLEVBZG5CLGVBZUEiLCJmaWxlIjoiRDpcXHJlYWN0U3R1ZHlcXE5leHQtS29hLUdpdEh1YlxcbmV4dC1naXRodWJcXHBhZ2VzXFxzZWFyY2guanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgd2l0aFJvdXRlciB9IGZyb20gJ25leHQvcm91dGVyJ1xyXG5pbXBvcnQgeyBtZW1vLCBpc1ZhbGlkRWxlbWVudCB9IGZyb20gJ3JlYWN0J1xyXG5pbXBvcnQge1xyXG4gIFJvdywgQ29sLCBMaXN0LCBQYWdpbmF0aW9uLFxyXG59IGZyb20gJ2FudGQnXHJcbmltcG9ydCBMaW5rIGZyb20gJ25leHQvbGluaydcclxuY29uc3QgYXRvYiA9IHJlcXVpcmUoJ2F0b2InKVxyXG5pbXBvcnQgUmVwbyBmcm9tICcuLi9jb21wb25lbnRzL1JlcG8nXHJcbmltcG9ydCB7IGdlbkNhY2hlS2V5QnlRdWVyeSB9IGZyb20gJy4uL2xpYi91dGlsJ1xyXG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJ1xyXG5cclxuY29uc3QgYXBpID0gcmVxdWlyZSgnLi4vbGliL2FwaScpXHJcbmdsb2JhbC5hdG9iID0gYXRvYlxyXG5cclxuLyoqXHJcbiAgKiDlhbPlv4PnmoRzZWFyY2jmnaHku7ZcclxuICAqIHNvcnQ6IOaOkuW6j+aWueW8j1xyXG4gICogb3JkZXI6IOaOkuW6j+WNh+mZjemhuuW6j1xyXG4gICogbGFuZzog5LuT5bqT5byA5Y+R5Li76K+t6KiAXHJcbiAgKiBwYWdlOiDliIbpobVcclxuICAqL1xyXG4gY29uc3QgTEFOR1VBR0VTID0gWydKYXZhU2NyaXB0JywgJ0hUTUwnLCAnQ1NTJywgJ1R5cGVTY3JpcHQnLCAnSmF2YScsICdWdWUnLCAnUmVhY3QnXVxyXG4gY29uc3QgU09SVF9UWVBFUyA9IFtcclxuICAge1xyXG4gICAgIG5hbWU6ICdCZXN0IE1hdGNoJyxcclxuICAgfSxcclxuICAge1xyXG4gICAgIG5hbWU6ICdNb3N0IFN0YXJ0cycsXHJcbiAgICAgc29ydDogJ3N0YXJzJyxcclxuICAgICBvcmRlcjogJ2Rlc2MnLFxyXG4gICB9LFxyXG4gICB7XHJcbiAgICAgbmFtZTogJ0Zld2VzdCBTdGFydHMnLFxyXG4gICAgIHNvcnQ6ICdzdGFycycsXHJcbiAgICAgb3JkZXI6ICdhc2MnLFxyXG4gICB9LFxyXG4gICB7XHJcbiAgICAgbmFtZTogJ01vc3QgRm9ya3MnLFxyXG4gICAgIHNvcnQ6ICdmb3JrcycsXHJcbiAgICAgb3JkZXI6ICdkZXNjJyxcclxuICAgfSxcclxuICAge1xyXG4gICAgIG5hbWU6ICdGZXdlc3QgRm9ya3MnLFxyXG4gICAgIHNvcnQ6ICdmb3JrcycsXHJcbiAgICAgb3JkZXI6ICdhc2MnLFxyXG4gICB9LFxyXG4gXVxyXG5cclxuIGNvbnN0IFBFUl9QQUdFID0gMjBcclxuXHJcbiBjb25zdCBGaWx0ZXJMaW5rID0gbWVtbygoe1xyXG4gIGNoaWxkcmVuLCBxdWVyeSwgbGFuZywgc29ydCwgb3JkZXIsIHBhZ2UsIHNlbGVjdGVkLFxyXG59KSA9PiB7XHJcbiAgaWYgKHNlbGVjdGVkKSB7XHJcbiAgICByZXR1cm4gPHNwYW4+e2NoaWxkcmVufTwvc3Bhbj5cclxuICB9XHJcblxyXG4gIGxldCBxdWVyeVN0cmluZyA9IGA/cXVlcnk9JHtxdWVyeX1gXHJcblxyXG4gIGlmIChsYW5nKSB7XHJcbiAgICBxdWVyeVN0cmluZyArPSBgJmxhbmc9JHtsYW5nfWBcclxuICB9XHJcblxyXG4gIGlmIChzb3J0KSB7XHJcbiAgICBxdWVyeVN0cmluZyArPSBgJnNvcnQ9JHtzb3J0fSZvcmRlcj0ke29yZGVyfWBcclxuICB9XHJcblxyXG4gIGlmIChwYWdlKSB7XHJcbiAgICBxdWVyeVN0cmluZyArPSBgJnBhZ2U9JHtwYWdlfWBcclxuICB9XHJcblxyXG4gIHF1ZXJ5U3RyaW5nICs9IGAmcGVyX3BhZ2U9JHtQRVJfUEFHRX1gXHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8TGluayBocmVmPXtgL3NlYXJjaCR7cXVlcnlTdHJpbmd9YH0+XHJcbiAgICAgIHtpc1ZhbGlkRWxlbWVudChjaGlsZHJlbikgPyBjaGlsZHJlbiA6IDxhPntjaGlsZHJlbn08L2E+fVxyXG4gICAgPC9MaW5rPlxyXG4gIClcclxufSlcclxuXHJcblxyXG5mdW5jdGlvbiBTZWFyY2goeyByb3V0ZXIsIHJlcG9zIH0pIHtcclxuICBjb25zdCB7IHF1ZXJ5IH0gPSByb3V0ZXJcclxuICBjb25zdCB7XHJcbiAgICBzb3J0LCBvcmRlciwgbGFuZywgcGFnZSA9IDEsXHJcbiAgfSA9IHF1ZXJ5XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT1cInJvb3RcIj5cclxuICAgICAgPFJvdyBndXR0ZXI9ezIwfT5cclxuICAgICAgICA8Q29sIHNwYW49ezZ9PlxyXG4gICAgICAgICAgPExpc3RcclxuICAgICAgICAgICAgYm9yZGVyZWRcclxuICAgICAgICAgICAgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAyMCB9fVxyXG4gICAgICAgICAgICBkYXRhU291cmNlPXtMQU5HVUFHRVN9XHJcbiAgICAgICAgICAgIGhlYWRlcj17KFxyXG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxpc3QtaGVhZGVyXCI+6K+t6KiAPC9zcGFuPlxyXG4gICAgICAgICAgICApfVxyXG4gICAgICAgICAgICByZW5kZXJJdGVtPXsobGFuZ3VhZ2UpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGxhbmcgPT09IGxhbmd1YWdlXHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICA8TGlzdC5JdGVtIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyh7XHJcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkLFxyXG4gICAgICAgICAgICAgICAgfSl9XHJcbiAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgIDxGaWx0ZXJMaW5rXHJcbiAgICAgICAgICAgICAgICAgICAgey4uLnJvdXRlci5xdWVyeX1cclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZD17c2VsZWN0ZWR9XHJcbiAgICAgICAgICAgICAgICAgICAgbGFuZz17bGFuZ3VhZ2V9XHJcbiAgICAgICAgICAgICAgICAgID57bGFuZ3VhZ2V9XHJcbiAgICAgICAgICAgICAgICAgIDwvRmlsdGVyTGluaz5cclxuICAgICAgICAgICAgICAgIDwvTGlzdC5JdGVtPlxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgfX1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8TGlzdFxyXG4gICAgICAgICAgICBib3JkZXJlZFxyXG4gICAgICAgICAgICBzdHlsZT17eyBtYXJnaW5Cb3R0b206IDIwIH19XHJcbiAgICAgICAgICAgIGRhdGFTb3VyY2U9e1NPUlRfVFlQRVN9XHJcbiAgICAgICAgICAgIGhlYWRlcj17KFxyXG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxpc3QtaGVhZGVyXCI+5o6S5bqPPC9zcGFuPlxyXG4gICAgICAgICAgICApfVxyXG4gICAgICAgICAgICByZW5kZXJJdGVtPXsoc29ydEl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB7IG5hbWU6IGl0ZW1OYW1lLCBzb3J0OiBpdGVtU29ydCwgb3JkZXI6IGl0ZW1PcmRlciB9ID0gc29ydEl0ZW1cclxuICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWQgPSBmYWxzZVxyXG4gICAgICAgICAgICAgIGlmIChpdGVtTmFtZSA9PT0gJ0Jlc3QgTWF0Y2gnICYmICFzb3J0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IHRydWVcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW1Tb3J0ID09PSBzb3J0ICYmIGl0ZW1PcmRlciA9PT0gb3JkZXIpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgPExpc3QuSXRlbSBjbGFzc05hbWU9e2NsYXNzTmFtZXMoe1xyXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZCxcclxuICAgICAgICAgICAgICAgIH0pfVxyXG4gICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICA8RmlsdGVyTGlua1xyXG4gICAgICAgICAgICAgICAgICAgIHsuLi5yb3V0ZXIucXVlcnl9XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ9e3NlbGVjdGVkfVxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnQ9e2l0ZW1Tb3J0fVxyXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyPXtpdGVtT3JkZXJ9XHJcbiAgICAgICAgICAgICAgICAgID57aXRlbU5hbWV9XHJcbiAgICAgICAgICAgICAgICAgIDwvRmlsdGVyTGluaz5cclxuICAgICAgICAgICAgICAgIDwvTGlzdC5JdGVtPlxyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgfX1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgPC9Db2w+XHJcbiAgICAgICAgPENvbCBzcGFuPXsxOH0+XHJcbiAgICAgICAgICA8aDMgY2xhc3NOYW1lPVwicmVwb3MtdGl0bGVcIj57cmVwb3MudG90YWxfY291bnR9IOS4quS7k+W6kzwvaDM+XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlcG9zLml0ZW1zLm1hcCgocmVwbykgPT4gPFJlcG8gcmVwbz17cmVwb30ga2V5PXtyZXBvLmlkfSAvPilcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicGFnaW5hdGlvblwiPlxyXG4gICAgICAgICAgICA8UGFnaW5hdGlvblxyXG4gICAgICAgICAgICAgIHBhZ2VTaXplPXtQRVJfUEFHRX1cclxuICAgICAgICAgICAgICBjdXJyZW50PXtOdW1iZXIocGFnZSl9XHJcbiAgICAgICAgICAgICAgLy8gZ2l0aHViIGFwaemZkOWItuivt+axguWJjTEwMDDmnaFcclxuICAgICAgICAgICAgICB0b3RhbD17TWF0aC5taW4ocmVwb3MudG90YWxfY291bnQsIDEwMDApfVxyXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoKSA9PiB7fX1cclxuICAgICAgICAgICAgICBpdGVtUmVuZGVyPXsocmVuZGVyUGFnZSwgcmVuZGVyVHlwZSwgcmVuZGVyT2wpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFBhZ2UgPSByZW5kZXJUeXBlID09PSAncGFnZSdcclxuICAgICAgICAgICAgICAgICAgPyByZW5kZXJQYWdlXHJcbiAgICAgICAgICAgICAgICAgIDogcmVuZGVyVHlwZSA9PT0gJ3ByZXYnXHJcbiAgICAgICAgICAgICAgICAgICAgPyBwYWdlIC0gMVxyXG4gICAgICAgICAgICAgICAgICAgIDogcGFnZSArIDFcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gcmVuZGVyVHlwZSA9PT0gJ3BhZ2UnID8gcmVuZGVyUGFnZSA6IHJlbmRlck9sXHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDxGaWx0ZXJMaW5rIHsuLi5yb3V0ZXIucXVlcnl9IHBhZ2U9e3RhcmdldFBhZ2V9PntuYW1lfTwvRmlsdGVyTGluaz5cclxuICAgICAgICAgICAgICB9fVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9Db2w+XHJcbiAgICAgIDwvUm93PlxyXG4gICAgICA8c3R5bGUganN4PntgXHJcbiAgICAgICAgOmdsb2JhbCguYW50LWxpc3QtaXRlbS5zZWxlY3RlZCkge1xyXG4gICAgICAgICAgYm9yZGVyLWxlZnQ6IDJweCBzb2xpZCAjZTM2MjA5O1xyXG4gICAgICAgICAgZm9udC13ZWlnaHQ6IDEwMFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAucm9vdCB7XHJcbiAgICAgICAgICBwYWRkaW5nOiAyMHB4IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAubGlzdC1oZWFkZXIge1xyXG4gICAgICAgICAgZm9udC13ZWlnaHQ6IDgwMDtcclxuICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC5yZXBvcy10aXRsZSB7XHJcbiAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTtcclxuICAgICAgICAgIGZvbnQtc2l6ZTogMjRweDtcclxuICAgICAgICAgIGxpbmUtaGVpZ2h0OiA1MHB4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLnBhZ2luYXRpb24ge1xyXG4gICAgICAgICAgbWFyZ2luLXRvcDogMTZweDtcclxuICAgICAgICAgIHRleHQtYWxpZ246IHJpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgIGB9XHJcbiAgICAgIDwvc3R5bGU+XHJcbiAgICA8L2Rpdj5cclxuICApXHJcbn1cclxuXHJcblxyXG5cclxuU2VhcmNoLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jICh7IGN0eCB9KSA9PiB7XHJcbiAgY29uc3Qge1xyXG4gICAgcXVlcnksIHNvcnQsIGxhbmcsIG9yZGVyID0gJ2Rlc2MnLCBwYWdlLFxyXG4gIH0gPSBjdHgucXVlcnlcclxuXHJcbiAgaWYgKCFxdWVyeSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVwb3M6IHtcclxuICAgICAgICB0b3RhbF9jb3VudDogMCxcclxuICAgICAgfSxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGxldCBxdWVyeVN0cmluZyA9IGA/cT0ke3F1ZXJ5fWBcclxuXHJcbiAgaWYgKGxhbmcpIHtcclxuICAgIHF1ZXJ5U3RyaW5nICs9IGArbGFuZ3VhZ2U6JHtsYW5nfWBcclxuICB9XHJcblxyXG4gIGlmIChzb3J0KSB7XHJcbiAgICBxdWVyeVN0cmluZyArPSBgJnNvcnQ9JHtzb3J0fSZvcmRlcj0ke29yZGVyfWBcclxuICB9XHJcblxyXG4gIGlmIChwYWdlKSB7XHJcbiAgICBxdWVyeVN0cmluZyArPSBgJnBhZ2U9JHtwYWdlfWBcclxuICB9XHJcblxyXG4gIHF1ZXJ5U3RyaW5nICs9IGAmcGVyX3BhZ2U9JHtQRVJfUEFHRX1gXHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaS5yZXF1ZXN0KHtcclxuICAgIHVybDogYC9zZWFyY2gvcmVwb3NpdG9yaWVzJHtxdWVyeVN0cmluZ31gLFxyXG4gIH0sIGN0eC5yZXEsIGN0eC5yZXMpXHJcblxyXG4gIHJldHVybiB7XHJcbiAgICByZXBvczogcmVzdWx0LmRhdGEsXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB3aXRoUm91dGVyKFNlYXJjaCkiXX0= */\\n/*@ sourceURL=D:\\\\reactStudy\\\\Next-Koa-GitHub\\\\next-github\\\\pages\\\\search.js */\"));\n}\n\nSearch.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(_ref3) {\n    var ctx, _ctx$query, query, sort, lang, _ctx$query$order, order, page, queryString, result;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            ctx = _ref3.ctx;\n            _ctx$query = ctx.query, query = _ctx$query.query, sort = _ctx$query.sort, lang = _ctx$query.lang, _ctx$query$order = _ctx$query.order, order = _ctx$query$order === void 0 ? 'desc' : _ctx$query$order, page = _ctx$query.page;\n\n            if (query) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              repos: {\n                total_count: 0\n              }\n            });\n\n          case 4:\n            queryString = \"?q=\".concat(query);\n\n            if (lang) {\n              queryString += \"+language:\".concat(lang);\n            }\n\n            if (sort) {\n              queryString += \"&sort=\".concat(sort, \"&order=\").concat(order);\n            }\n\n            if (page) {\n              queryString += \"&page=\".concat(page);\n            }\n\n            queryString += \"&per_page=\".concat(PER_PAGE);\n            _context.next = 11;\n            return api.request({\n              url: \"/search/repositories\".concat(queryString)\n            }, ctx.req, ctx.res);\n\n          case 11:\n            result = _context.sent;\n            return _context.abrupt(\"return\", {\n              repos: result.data\n            });\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default withRouter(Search);","map":{"version":3,"sources":["D:\\reactStudy\\Next-Koa-GitHub\\next-github\\pages\\search.js"],"names":["withRouter","memo","isValidElement","Link","atob","require","Repo","genCacheKeyByQuery","classNames","api","global","LANGUAGES","SORT_TYPES","name","sort","order","PER_PAGE","FilterLink","children","query","lang","page","selected","queryString","Search","router","repos","marginBottom","language","sortItem","itemName","itemSort","itemOrder","total_count","items","map","repo","id","Number","Math","min","renderPage","renderType","renderOl","targetPage","getInitialProps","ctx","request","url","req","res","result","data"],"mappings":"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","sourcesContent":["\r\nimport { withRouter } from 'next/router'\r\nimport { memo, isValidElement } from 'react'\r\nimport {\r\n  Row, Col, List, Pagination,\r\n} from 'antd'\r\nimport Link from 'next/link'\r\nconst atob = require('atob')\r\nimport Repo from '../components/Repo'\r\nimport { genCacheKeyByQuery } from '../lib/util'\r\nimport classNames from 'classnames'\r\n\r\nconst api = require('../lib/api')\r\nglobal.atob = atob\r\n\r\n/**\r\n  * 关心的search条件\r\n  * sort: 排序方式\r\n  * order: 排序升降顺序\r\n  * lang: 仓库开发主语言\r\n  * page: 分页\r\n  */\r\n const LANGUAGES = ['JavaScript', 'HTML', 'CSS', 'TypeScript', 'Java', 'Vue', 'React']\r\n const SORT_TYPES = [\r\n   {\r\n     name: 'Best Match',\r\n   },\r\n   {\r\n     name: 'Most Starts',\r\n     sort: 'stars',\r\n     order: 'desc',\r\n   },\r\n   {\r\n     name: 'Fewest Starts',\r\n     sort: 'stars',\r\n     order: 'asc',\r\n   },\r\n   {\r\n     name: 'Most Forks',\r\n     sort: 'forks',\r\n     order: 'desc',\r\n   },\r\n   {\r\n     name: 'Fewest Forks',\r\n     sort: 'forks',\r\n     order: 'asc',\r\n   },\r\n ]\r\n\r\n const PER_PAGE = 20\r\n\r\n const FilterLink = memo(({\r\n  children, query, lang, sort, order, page, selected,\r\n}) => {\r\n  if (selected) {\r\n    return <span>{children}</span>\r\n  }\r\n\r\n  let queryString = `?query=${query}`\r\n\r\n  if (lang) {\r\n    queryString += `&lang=${lang}`\r\n  }\r\n\r\n  if (sort) {\r\n    queryString += `&sort=${sort}&order=${order}`\r\n  }\r\n\r\n  if (page) {\r\n    queryString += `&page=${page}`\r\n  }\r\n\r\n  queryString += `&per_page=${PER_PAGE}`\r\n\r\n  return (\r\n    <Link href={`/search${queryString}`}>\r\n      {isValidElement(children) ? children : <a>{children}</a>}\r\n    </Link>\r\n  )\r\n})\r\n\r\n\r\nfunction Search({ router, repos }) {\r\n  const { query } = router\r\n  const {\r\n    sort, order, lang, page = 1,\r\n  } = query\r\n\r\n  return (\r\n    <div className=\"root\">\r\n      <Row gutter={20}>\r\n        <Col span={6}>\r\n          <List\r\n            bordered\r\n            style={{ marginBottom: 20 }}\r\n            dataSource={LANGUAGES}\r\n            header={(\r\n              <span className=\"list-header\">语言</span>\r\n            )}\r\n            renderItem={(language) => {\r\n              const selected = lang === language\r\n\r\n              return (\r\n                <List.Item className={classNames({\r\n                  selected,\r\n                })}\r\n                >\r\n                  <FilterLink\r\n                    {...router.query}\r\n                    selected={selected}\r\n                    lang={language}\r\n                  >{language}\r\n                  </FilterLink>\r\n                </List.Item>\r\n              )\r\n            }}\r\n          />\r\n          <List\r\n            bordered\r\n            style={{ marginBottom: 20 }}\r\n            dataSource={SORT_TYPES}\r\n            header={(\r\n              <span className=\"list-header\">排序</span>\r\n            )}\r\n            renderItem={(sortItem) => {\r\n              const { name: itemName, sort: itemSort, order: itemOrder } = sortItem\r\n              let selected = false\r\n              if (itemName === 'Best Match' && !sort) {\r\n                selected = true\r\n              } else if (itemSort === sort && itemOrder === order) {\r\n                selected = true\r\n              }\r\n              return (\r\n                <List.Item className={classNames({\r\n                  selected,\r\n                })}\r\n                >\r\n                  <FilterLink\r\n                    {...router.query}\r\n                    selected={selected}\r\n                    sort={itemSort}\r\n                    order={itemOrder}\r\n                  >{itemName}\r\n                  </FilterLink>\r\n                </List.Item>\r\n              )\r\n            }}\r\n          />\r\n        </Col>\r\n        <Col span={18}>\r\n          <h3 className=\"repos-title\">{repos.total_count} 个仓库</h3>\r\n          {\r\n            repos.items.map((repo) => <Repo repo={repo} key={repo.id} />)\r\n          }\r\n          <div className=\"pagination\">\r\n            <Pagination\r\n              pageSize={PER_PAGE}\r\n              current={Number(page)}\r\n              // github api限制请求前1000条\r\n              total={Math.min(repos.total_count, 1000)}\r\n              onChange={() => {}}\r\n              itemRender={(renderPage, renderType, renderOl) => {\r\n                const targetPage = renderType === 'page'\r\n                  ? renderPage\r\n                  : renderType === 'prev'\r\n                    ? page - 1\r\n                    : page + 1\r\n\r\n                const name = renderType === 'page' ? renderPage : renderOl\r\n\r\n                return <FilterLink {...router.query} page={targetPage}>{name}</FilterLink>\r\n              }}\r\n            />\r\n          </div>\r\n        </Col>\r\n      </Row>\r\n      <style jsx>{`\r\n        :global(.ant-list-item.selected) {\r\n          border-left: 2px solid #e36209;\r\n          font-weight: 100\r\n        }\r\n        \r\n        .root {\r\n          padding: 20px 0;\r\n        }\r\n\r\n        .list-header {\r\n          font-weight: 800;\r\n          font-size: 16px;\r\n        }\r\n\r\n        .repos-title {\r\n          border-bottom: 1px solid #eee;\r\n          font-size: 24px;\r\n          line-height: 50px;\r\n        }\r\n\r\n        .pagination {\r\n          margin-top: 16px;\r\n          text-align: right;\r\n        }\r\n       `}\r\n      </style>\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n\r\nSearch.getInitialProps = async ({ ctx }) => {\r\n  const {\r\n    query, sort, lang, order = 'desc', page,\r\n  } = ctx.query\r\n\r\n  if (!query) {\r\n    return {\r\n      repos: {\r\n        total_count: 0,\r\n      },\r\n    }\r\n  }\r\n\r\n  let queryString = `?q=${query}`\r\n\r\n  if (lang) {\r\n    queryString += `+language:${lang}`\r\n  }\r\n\r\n  if (sort) {\r\n    queryString += `&sort=${sort}&order=${order}`\r\n  }\r\n\r\n  if (page) {\r\n    queryString += `&page=${page}`\r\n  }\r\n\r\n  queryString += `&per_page=${PER_PAGE}`\r\n\r\n  const result = await api.request({\r\n    url: `/search/repositories${queryString}`,\r\n  }, ctx.req, ctx.res)\r\n\r\n  return {\r\n    repos: result.data,\r\n  }\r\n}\r\n\r\nexport default withRouter(Search)"]},"metadata":{},"sourceType":"module"}