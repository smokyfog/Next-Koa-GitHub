{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"antd/lib/spin/style/css\";\nimport _Spin from \"antd/lib/spin\";\nimport \"antd/lib/select/style/css\";\nimport _Select from \"antd/lib/select\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useCallback, useRef } from 'react';\nimport debounce from 'lodash/debounce';\nimport { request } from '../lib/api';\nconst {\n  Option\n} = _Select;\n\nfunction SearchUser({\n  onChange,\n  value,\n  style\n}) {\n  const {\n    0: fetching,\n    1: setFetching\n  } = useState(false);\n  const {\n    0: options,\n    1: setOptions\n  } = useState([]);\n  const lastFetchIdRef = useRef(0);\n  const fetchUser = useCallback(debounce(async (searchValue, fetchId) => {\n    setFetching(true);\n    setOptions([]);\n    const {\n      data\n    } = await request({\n      url: `/search/users?q=${searchValue}`\n    });\n    const userOptions = data.items.map(user => ({\n      text: user.login,\n      value: user.login\n    }));\n\n    if (fetchId === lastFetchIdRef.current) {\n      setOptions(userOptions);\n    } else {\n      setOptions([]);\n    }\n\n    setFetching(false);\n  }, 500), []);\n\n  const fetchUserBefore = searchValue => {\n    lastFetchIdRef.current += 1;\n\n    if (searchValue.trim()) {\n      return fetchUser(searchValue, lastFetchIdRef.current);\n    }\n\n    return null;\n  };\n\n  const handleChange = selectValue => {\n    onChange(selectValue);\n    setOptions([]);\n  };\n\n  return __jsx(_Select, {\n    allowClear: true,\n    showSearch: true,\n    value: value,\n    onChange: handleChange,\n    onSearch: fetchUserBefore,\n    notFoundContent: fetching ? __jsx(_Spin, {\n      size: \"small\"\n    }) : __jsx(\"span\", null, \"\\u627E\\u4E0D\\u5230\\u7528\\u6237\") // 禁用本地搜索\n    ,\n    filterOption: false,\n    placeholder: \"\\u521B\\u5EFA\\u8005\",\n    style: _objectSpread({\n      width: 200\n    }, style)\n  }, options.map(option => {\n    const {\n      value: optionValue,\n      text: optionText\n    } = option;\n    return __jsx(Option, {\n      key: optionValue,\n      value: optionValue\n    }, optionText);\n  }));\n}\n\nexport default SearchUser;","map":{"version":3,"sources":["D:\\reactStudy\\Next-Koa-GitHub\\next-github\\components\\SearchUser.jsx"],"names":["useState","useCallback","useRef","debounce","request","Option","SearchUser","onChange","value","style","fetching","setFetching","options","setOptions","lastFetchIdRef","fetchUser","searchValue","fetchId","data","url","userOptions","items","map","user","text","login","current","fetchUserBefore","trim","handleChange","selectValue","width","option","optionValue","optionText"],"mappings":";;;;;;;AAAA,SAASA,QAAT,EAAmBC,WAAnB,EAAgCC,MAAhC,QAA8C,OAA9C;AAEA,OAAOC,QAAP,MAAqB,iBAArB;AACA,SAASC,OAAT,QAAwB,YAAxB;AAEA,MAAM;AAAEC,EAAAA;AAAF,WAAN;;AAEA,SAASC,UAAT,CAAoB;AAAEC,EAAAA,QAAF;AAAYC,EAAAA,KAAZ;AAAmBC,EAAAA;AAAnB,CAApB,EAAgD;AAC9C,QAAM;AAAA,OAACC,QAAD;AAAA,OAAWC;AAAX,MAA0BX,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM;AAAA,OAACY,OAAD;AAAA,OAAUC;AAAV,MAAwBb,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAMc,cAAc,GAAGZ,MAAM,CAAC,CAAD,CAA7B;AAEA,QAAMa,SAAS,GAAGd,WAAW,CAC3BE,QAAQ,CACN,OAAOa,WAAP,EAAoBC,OAApB,KAAgC;AAC9BN,IAAAA,WAAW,CAAC,IAAD,CAAX;AACAE,IAAAA,UAAU,CAAC,EAAD,CAAV;AACA,UAAM;AAAEK,MAAAA;AAAF,QAAW,MAAMd,OAAO,CAAC;AAC7Be,MAAAA,GAAG,EAAG,mBAAkBH,WAAY;AADP,KAAD,CAA9B;AAGA,UAAMI,WAAW,GAAGF,IAAI,CAACG,KAAL,CAAWC,GAAX,CAAiBC,IAAD,KAAW;AAC7CC,MAAAA,IAAI,EAAED,IAAI,CAACE,KADkC;AAE7CjB,MAAAA,KAAK,EAAEe,IAAI,CAACE;AAFiC,KAAX,CAAhB,CAApB;;AAKA,QAAIR,OAAO,KAAKH,cAAc,CAACY,OAA/B,EAAwC;AACtCb,MAAAA,UAAU,CAACO,WAAD,CAAV;AACD,KAFD,MAEO;AACLP,MAAAA,UAAU,CAAC,EAAD,CAAV;AACD;;AACDF,IAAAA,WAAW,CAAC,KAAD,CAAX;AACD,GAlBK,EAmBN,GAnBM,CADmB,EAsB3B,EAtB2B,CAA7B;;AAyBA,QAAMgB,eAAe,GAAIX,WAAD,IAAiB;AACvCF,IAAAA,cAAc,CAACY,OAAf,IAA0B,CAA1B;;AACA,QAAIV,WAAW,CAACY,IAAZ,EAAJ,EAAwB;AACtB,aAAOb,SAAS,CAACC,WAAD,EAAcF,cAAc,CAACY,OAA7B,CAAhB;AACD;;AACD,WAAO,IAAP;AACD,GAND;;AAQA,QAAMG,YAAY,GAAIC,WAAD,IAAiB;AACpCvB,IAAAA,QAAQ,CAACuB,WAAD,CAAR;AACAjB,IAAAA,UAAU,CAAC,EAAD,CAAV;AACD,GAHD;;AAKA,SACE;AACE,IAAA,UAAU,MADZ;AAEE,IAAA,UAAU,MAFZ;AAGE,IAAA,KAAK,EAAEL,KAHT;AAIE,IAAA,QAAQ,EAAEqB,YAJZ;AAKE,IAAA,QAAQ,EAAEF,eALZ;AAME,IAAA,eAAe,EAAEjB,QAAQ,GAAG;AAAM,MAAA,IAAI,EAAC;AAAX,MAAH,GAA2B,qDANtD,CAOE;AAPF;AAQE,IAAA,YAAY,EAAE,KARhB;AASE,IAAA,WAAW,EAAC,oBATd;AAUE,IAAA,KAAK;AAAKqB,MAAAA,KAAK,EAAE;AAAZ,OAAoBtB,KAApB;AAVP,KAYGG,OAAO,CAACU,GAAR,CAAaU,MAAD,IAAY;AACvB,UAAM;AACJxB,MAAAA,KAAK,EAAEyB,WADH;AAEJT,MAAAA,IAAI,EAAEU;AAFF,QAGFF,MAHJ;AAIA,WACE,MAAC,MAAD;AAAQ,MAAA,GAAG,EAAEC,WAAb;AAA0B,MAAA,KAAK,EAAEA;AAAjC,OACGC,UADH,CADF;AAKD,GAVA,CAZH,CADF;AA0BD;;AAED,eAAe5B,UAAf","sourcesContent":["import { useState, useCallback, useRef } from 'react'\r\nimport { Select, Spin } from 'antd'\r\nimport debounce from 'lodash/debounce'\r\nimport { request } from '../lib/api'\r\n\r\nconst { Option } = Select\r\n\r\nfunction SearchUser({ onChange, value, style }) {\r\n  const [fetching, setFetching] = useState(false)\r\n  const [options, setOptions] = useState([])\r\n  const lastFetchIdRef = useRef(0)\r\n\r\n  const fetchUser = useCallback(\r\n    debounce(\r\n      async (searchValue, fetchId) => {\r\n        setFetching(true)\r\n        setOptions([])\r\n        const { data } = await request({\r\n          url: `/search/users?q=${searchValue}`,\r\n        })\r\n        const userOptions = data.items.map(((user) => ({\r\n          text: user.login,\r\n          value: user.login,\r\n        })))\r\n\r\n        if (fetchId === lastFetchIdRef.current) {\r\n          setOptions(userOptions)\r\n        } else {\r\n          setOptions([])\r\n        }\r\n        setFetching(false)\r\n      },\r\n      500,\r\n    ),\r\n    [],\r\n  )\r\n\r\n  const fetchUserBefore = (searchValue) => {\r\n    lastFetchIdRef.current += 1\r\n    if (searchValue.trim()) {\r\n      return fetchUser(searchValue, lastFetchIdRef.current)\r\n    }\r\n    return null\r\n  }\r\n\r\n  const handleChange = (selectValue) => {\r\n    onChange(selectValue)\r\n    setOptions([])\r\n  }\r\n\r\n  return (\r\n    <Select\r\n      allowClear\r\n      showSearch\r\n      value={value}\r\n      onChange={handleChange}\r\n      onSearch={fetchUserBefore}\r\n      notFoundContent={fetching ? <Spin size=\"small\" /> : <span>找不到用户</span>}\r\n      // 禁用本地搜索\r\n      filterOption={false}\r\n      placeholder=\"创建者\"\r\n      style={({ width: 200, ...style })}\r\n    >\r\n      {options.map((option) => {\r\n        const {\r\n          value: optionValue,\r\n          text: optionText,\r\n        } = option\r\n        return (\r\n          <Option key={optionValue} value={optionValue}>\r\n            {optionText}\r\n          </Option>\r\n        )\r\n      })}\r\n    </Select>\r\n  )\r\n}\r\n\r\nexport default SearchUser\r\n"]},"metadata":{},"sourceType":"module"}